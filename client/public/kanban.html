<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Agent Kanban Dashboard</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: 700;
        }

        .project-stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }

        .stat-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            text-align: center;
            min-width: 120px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .stat-card p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #2c3e50;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .project-overview {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .agent-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .agent-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .agent-info h3 {
            color: #2c3e50;
            font-size: 1.3em;
            margin-bottom: 5px;
        }

        .agent-type {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .agent-metrics {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .metric {
            text-align: center;
            flex: 1;
        }

        .metric-value {
            font-size: 1.5em;
            font-weight: 700;
            color: #2c3e50;
        }

        .metric-label {
            font-size: 0.8em;
            color: #7f8c8d;
            margin-top: 2px;
        }

        .kanban-board {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .kanban-column {
            min-width: 250px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            border: 2px solid #e9ecef;
        }

        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
        }

        .column-title {
            font-weight: 700;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .task-count {
            background: #6c757d;
            color: white;
            padding: 4px 8px;
            border-radius: 50%;
            font-size: 0.8em;
            font-weight: 600;
            min-width: 24px;
            text-align: center;
        }

        .todo .task-count { background: #17a2b8; }
        .inProgress .task-count { background: #ffc107; }
        .review .task-count { background: #fd7e14; }
        .completed .task-count { background: #28a745; }
        .blocked .task-count { background: #dc3545; }

        .task-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #6c757d;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .task-card.high-priority { border-left-color: #dc3545; }
        .task-card.medium-priority { border-left-color: #ffc107; }
        .task-card.low-priority { border-left-color: #28a745; }

        .task-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .task-description {
            color: #6c757d;
            font-size: 0.9em;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e9ecef;
        }

        .task-effort {
            background: #e9ecef;
            color: #495057;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .skill-match {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .task-progress {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin-top: 8px;
            overflow: hidden;
        }

        .task-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            transition: width 0.3s ease;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-idle { background: #6c757d; }
        .status-working { background: #ffc107; }
        .status-completed { background: #28a745; }
        .status-error { background: #dc3545; }

        .real-time-updates {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 300px;
            z-index: 1000;
        }

        .update-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .update-item:last-child {
            border-bottom: none;
        }

        .update-time {
            font-size: 0.8em;
            color: #6c757d;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #495057;
        }

        @media (max-width: 768px) {
            .agents-grid {
                grid-template-columns: 1fr;
            }
            
            .kanban-board {
                flex-direction: column;
            }
            
            .kanban-column {
                min-width: auto;
            }
            
            .project-stats {
                flex-wrap: wrap;
            }
            
            .real-time-updates {
                position: relative;
                top: auto;
                right: auto;
                margin-top: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>Multi-Agent Kanban Dashboard</h1>
            <p>LangGraph-inspired orchestration with real-time agent workflows</p>
            <div class="project-stats">
                <div class="stat-card">
                    <h3 id="totalTasks">0</h3>
                    <p>Total Tasks</p>
                </div>
                <div class="stat-card">
                    <h3 id="activeAgents">0</h3>
                    <p>Active Agents</p>
                </div>
                <div class="stat-card">
                    <h3 id="completedTasks">0</h3>
                    <p>Completed</p>
                </div>
                <div class="stat-card">
                    <h3 id="projectProgress">0%</h3>
                    <p>Progress</p>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">Project Overview</button>
            <button class="tab" onclick="showTab('agents')">Agent Boards</button>
            <button class="tab" onclick="showTab('metrics')">Analytics</button>
        </div>

        <div id="overview" class="tab-content active">
            <div class="project-overview">
                <h2>Project Task Flow</h2>
                <div id="projectKanban" class="kanban-board">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading project data...</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="agents" class="tab-content">
            <div class="agents-grid" id="agentsGrid">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading agent data...</p>
                </div>
            </div>
        </div>

        <div id="metrics" class="tab-content">
            <div class="project-overview">
                <h2>System Analytics</h2>
                <div id="analyticsContent">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading analytics...</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="real-time-updates">
            <h3>Live Updates</h3>
            <div id="updatesList">
                <div class="empty-state">
                    <p>No updates yet</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        
        let currentProject = null;
        let agents = new Map();
        let realtimeUpdates = [];
        let maxUpdates = 10;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeSocket();
            requestInitialData();
        });

        function initializeSocket() {
            socket.on('connect', () => {
                console.log('Connected to server');
                addRealtimeUpdate('Connected to server', 'info');
            });

            socket.on('disconnect', () => {
                console.log('Disconnected from server');
                addRealtimeUpdate('Disconnected from server', 'warning');
            });

            // Project orchestration events
            socket.on('project_orchestrated', (data) => {
                console.log('Project orchestrated:', data);
                currentProject = data;
                updateProjectOverview(data);
                updateAgentBoards(data.agentAssignments);
                updateProjectStats(data);
                addRealtimeUpdate(`Project orchestrated with ${data.taskGraph.nodes.length} tasks`, 'success');
            });

            // Task events
            socket.on('task_started', (data) => {
                console.log('Task started:', data);
                updateTaskStatus(data.taskId, 'in_progress', data.agentId);
                addRealtimeUpdate(`Task started: ${data.task.title}`, 'info');
            });

            socket.on('task_completed', (data) => {
                console.log('Task completed:', data);
                updateTaskStatus(data.taskId, 'completed', data.agentId);
                addRealtimeUpdate(`Task completed: ${data.task.title}`, 'success');
            });

            socket.on('task_failed', (data) => {
                console.log('Task failed:', data);
                updateTaskStatus(data.taskId, 'failed', data.agentId);
                addRealtimeUpdate(`Task failed: ${data.task.title}`, 'error');
            });

            socket.on('task_retry', (data) => {
                console.log('Task retry:', data);
                updateTaskStatus(data.taskId, 'retry', data.agentId);
                addRealtimeUpdate(`Task retry #${data.retryCount}: ${data.task.title}`, 'warning');
            });

            // Agent events
            socket.on('agent_created', (data) => {
                console.log('Agent created:', data);
                agents.set(data.agent.id, data.agent);
                addRealtimeUpdate(`Agent created: ${data.agent.name}`, 'info');
                updateAgentBoards();
            });

            socket.on('agent_status_changed', (data) => {
                console.log('Agent status changed:', data);
                if (agents.has(data.agentId)) {
                    agents.get(data.agentId).status = data.status;
                    updateAgentStatus(data.agentId, data.status);
                    addRealtimeUpdate(`Agent ${data.agentId} status: ${data.status}`, 'info');
                }
            });

            // Kanban events
            socket.on('kanban_updated', (data) => {
                console.log('Kanban updated:', data);
                updateKanbanBoard(data);
                addRealtimeUpdate(`Task moved: ${data.from} â†’ ${data.to}`, 'info');
            });

            // Error handling
            socket.on('orchestration_error', (data) => {
                console.error('Orchestration error:', data);
                addRealtimeUpdate(`Error: ${data.error}`, 'error');
            });
        }

        function requestInitialData() {
            // Request current project state
            socket.emit('get_project_state');
            
            // Request agent states
            socket.emit('get_agent_states');
        }

        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        function updateProjectOverview(projectData) {
            const projectKanban = document.getElementById('projectKanban');
            
            if (!projectData || !projectData.kanbanBoard) {
                projectKanban.innerHTML = '<div class="empty-state"><h3>No Project Data</h3><p>Start a new project to see tasks here</p></div>';
                return;
            }
            
            const kanbanBoard = projectData.kanbanBoard;
            const columns = ['todo', 'inProgress', 'review', 'completed', 'blocked'];
            
            projectKanban.innerHTML = columns.map(column => `
                <div class="kanban-column ${column}">
                    <div class="column-header">
                        <span class="column-title">${formatColumnTitle(column)}</span>
                        <span class="task-count">${kanbanBoard.columns[column]?.length || 0}</span>
                    </div>
                    <div class="tasks-container">
                        ${(kanbanBoard.columns[column] || []).map(task => createTaskCard(task)).join('')}
                    </div>
                </div>
            `).join('');
        }

        function updateAgentBoards(agentAssignments = null) {
            const agentsGrid = document.getElementById('agentsGrid');
            
            if (!agentAssignments && (!currentProject || !currentProject.agentAssignments)) {
                agentsGrid.innerHTML = '<div class="empty-state"><h3>No Agents Active</h3><p>Start a project to see agent boards</p></div>';
                return;
            }
            
            const assignments = agentAssignments || currentProject.agentAssignments;
            
            agentsGrid.innerHTML = '';
            
            assignments.forEach((assignment, agentId) => {
                const agent = assignment.agent;
                const agentCard = document.createElement('div');
                agentCard.className = 'agent-card';
                agentCard.innerHTML = `
                    <div class="agent-header">
                        <div class="agent-info">
                            <h3>${agent.name}</h3>
                            <span class="agent-type">${agent.specialization}</span>
                        </div>
                        <div class="status-indicator status-${agent.status}"></div>
                    </div>
                    
                    <div class="agent-metrics">
                        <div class="metric">
                            <div class="metric-value">${agent.metrics.tasksCompleted || 0}</div>
                            <div class="metric-label">Completed</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${agent.metrics.tasksInProgress || 0}</div>
                            <div class="metric-label">In Progress</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${agent.metrics.successRate || 0}%</div>
                            <div class="metric-label">Success Rate</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${agent.workload || 0}%</div>
                            <div class="metric-label">Workload</div>
                        </div>
                    </div>
                    
                    <div class="kanban-board">
                        ${createAgentKanbanColumns(agent)}
                    </div>
                `;
                
                agentsGrid.appendChild(agentCard);
            });
        }

        function createAgentKanbanColumns(agent) {
            const columns = ['todo', 'inProgress', 'review', 'completed', 'blocked'];
            
            return columns.map(column => {
                const tasks = agent.kanban?.[column] || [];
                return `
                    <div class="kanban-column ${column}">
                        <div class="column-header">
                            <span class="column-title">${formatColumnTitle(column)}</span>
                            <span class="task-count">${tasks.length}</span>
                        </div>
                        <div class="tasks-container">
                            ${tasks.map(task => createTaskCard(task, true)).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function createTaskCard(task, isAgentView = false) {
            const priorityClass = task.priority ? `${task.priority}-priority` : 'medium-priority';
            const skillMatch = task.skillMatch || task.agentSpecificData?.skillMatch || 0;
            const effort = task.estimatedHours || task.agentSpecificData?.estimatedEffort || 0;
            const progress = task.progress || 0;
            
            return `
                <div class="task-card ${priorityClass}" data-task-id="${task.id}">
                    <div class="task-title">${task.title}</div>
                    <div class="task-description">${task.description.substring(0, 100)}${task.description.length > 100 ? '...' : ''}</div>
                    
                    <div class="task-meta">
                        <span class="task-effort">${effort}h</span>
                        ${isAgentView ? `<span class="skill-match">${Math.round(skillMatch)}% match</span>` : ''}
                    </div>
                    
                    ${progress > 0 ? `
                        <div class="task-progress">
                            <div class="task-progress-bar" style="width: ${progress}%"></div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function updateTaskStatus(taskId, status, agentId) {
            // Update task status in current project data
            if (currentProject && currentProject.taskGraph) {
                const taskNode = currentProject.taskGraph.nodes.find(n => n.id === taskId);
                if (taskNode) {
                    taskNode.data.status = status;
                    
                    // Update progress based on status
                    switch (status) {
                        case 'in_progress':
                            taskNode.data.progress = 25;
                            break;
                        case 'completed':
                            taskNode.data.progress = 100;
                            break;
                        case 'failed':
                            taskNode.data.progress = 0;
                            break;
                    }
                }
            }
            
            // Update UI
            updateProjectOverview(currentProject);
            updateAgentBoards();
            updateProjectStats(currentProject);
        }

        function updateProjectStats(projectData) {
            if (!projectData || !projectData.taskGraph) return;
            
            const totalTasks = projectData.taskGraph.nodes.length;
            const completedTasks = projectData.taskGraph.nodes.filter(n => n.data.status === 'completed').length;
            const activeAgents = projectData.agentAssignments ? projectData.agentAssignments.size : 0;
            const progress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('activeAgents').textContent = activeAgents;
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('projectProgress').textContent = progress + '%';
        }

        function addRealtimeUpdate(message, type = 'info') {
            const update = {
                message: message,
                type: type,
                timestamp: new Date()
            };
            
            realtimeUpdates.unshift(update);
            
            // Keep only the latest updates
            if (realtimeUpdates.length > maxUpdates) {
                realtimeUpdates = realtimeUpdates.slice(0, maxUpdates);
            }
            
            updateRealtimeDisplay();
        }

        function updateRealtimeDisplay() {
            const updatesList = document.getElementById('updatesList');
            
            if (realtimeUpdates.length === 0) {
                updatesList.innerHTML = '<div class="empty-state"><p>No updates yet</p></div>';
                return;
            }
            
            updatesList.innerHTML = realtimeUpdates.map(update => `
                <div class="update-item">
                    <div class="status-indicator status-${update.type}"></div>
                    <div>
                        <div>${update.message}</div>
                        <div class="update-time">${formatTime(update.timestamp)}</div>
                    </div>
                </div>
            `).join('');
        }

        function formatColumnTitle(column) {
            const titles = {
                'todo': 'To Do',
                'inProgress': 'In Progress',
                'review': 'Review',
                'completed': 'Completed',
                'blocked': 'Blocked'
            };
            return titles[column] || column;
        }

        function formatTime(timestamp) {
            return new Date(timestamp).toLocaleTimeString();
        }

        // Test data generation for demonstration
        function generateTestData() {
            const testProject = {
                id: 'test-project',
                taskGraph: {
                    nodes: [
                        {
                            id: 'task-1',
                            data: {
                                title: 'Frontend Development',
                                description: 'Create responsive user interface with React',
                                priority: 'high',
                                estimatedHours: 12,
                                status: 'in_progress',
                                progress: 45
                            }
                        },
                        {
                            id: 'task-2',
                            data: {
                                title: 'Backend API',
                                description: 'Build RESTful API with Node.js',
                                priority: 'high',
                                estimatedHours: 15,
                                status: 'todo',
                                progress: 0
                            }
                        },
                        {
                            id: 'task-3',
                            data: {
                                title: 'Database Design',
                                description: 'Design optimal database schema',
                                priority: 'medium',
                                estimatedHours: 8,
                                status: 'completed',
                                progress: 100
                            }
                        }
                    ]
                },
                kanbanBoard: {
                    columns: {
                        todo: [
                            {
                                id: 'task-2',
                                title: 'Backend API',
                                description: 'Build RESTful API with Node.js',
                                priority: 'high',
                                estimatedHours: 15,
                                status: 'todo'
                            }
                        ],
                        inProgress: [
                            {
                                id: 'task-1',
                                title: 'Frontend Development',
                                description: 'Create responsive user interface with React',
                                priority: 'high',
                                estimatedHours: 12,
                                status: 'in_progress',
                                progress: 45
                            }
                        ],
                        review: [],
                        completed: [
                            {
                                id: 'task-3',
                                title: 'Database Design',
                                description: 'Design optimal database schema',
                                priority: 'medium',
                                estimatedHours: 8,
                                status: 'completed'
                            }
                        ],
                        blocked: []
                    }
                },
                agentAssignments: new Map([
                    ['agent-1', {
                        agent: {
                            id: 'agent-1',
                            name: 'Frontend Specialist',
                            specialization: 'React Development',
                            status: 'working',
                            metrics: {
                                tasksCompleted: 5,
                                tasksInProgress: 1,
                                successRate: 95
                            },
                            workload: 75,
                            kanban: {
                                todo: [],
                                inProgress: [{
                                    id: 'task-1',
                                    title: 'Frontend Development',
                                    description: 'Create responsive user interface with React',
                                    priority: 'high',
                                    estimatedHours: 12,
                                    skillMatch: 95
                                }],
                                review: [],
                                completed: [{
                                    id: 'task-3',
                                    title: 'Database Design',
                                    description: 'Design optimal database schema',
                                    priority: 'medium',
                                    estimatedHours: 8,
                                    skillMatch: 85
                                }],
                                blocked: []
                            }
                        }
                    }])
                ])
            };
            
            currentProject = testProject;
            updateProjectOverview(testProject);
            updateAgentBoards(testProject.agentAssignments);
            updateProjectStats(testProject);
            
            // Add some test updates
            addRealtimeUpdate('Test project loaded', 'success');
            addRealtimeUpdate('Frontend agent assigned', 'info');
            addRealtimeUpdate('Database design completed', 'success');
        }

        // Load test data if no real data is available after 3 seconds
        setTimeout(() => {
            if (!currentProject) {
                console.log('Loading test data...');
                generateTestData();
            }
        }, 3000);
    </script>
</body>
</html> 